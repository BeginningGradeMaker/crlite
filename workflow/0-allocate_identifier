#!/usr/local/bin/python3

import os
import sys
import argparse
import __init__ as workflow

from datetime import datetime

parser = argparse.ArgumentParser()
parser.add_argument("--path", help="Path to folder on disk to store certs")

args = parser.parse_args()

if not args.path:
    parser.print_usage()
    sys.exit(0)

dateprefix = datetime.utcnow().date().strftime("%Y%m%d")
next_idx = 0

all_identifiers = workflow.get_run_identifiers('crlite_filters')
if all_identifiers:
    most_recent_identifier = all_identifiers.pop().rstrip("/")
    (date_part, idx_part) = most_recent_identifier.split("-")
    if date_part == dateprefix:
        next_idx = int(idx_part) + 1

allocatedName = "{}-{}".format(dateprefix, next_idx)
allocatedPath = os.path.join(args.path, allocatedName)

os.mkdir(allocatedPath)
print(allocatedPath)
